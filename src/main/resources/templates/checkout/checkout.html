<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/master}">

<head>
    <title layout:title="Thanh to√°n">Thanh to√°n</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/checkout.css">
    <style>
        .qr-modal {
            display: none;
            text-align: center;
            margin-top: 20px;
        }

        .qr-modal img {
            width: 250px;
            border-radius: 8px;
            border: 1px solid #ccc;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
<div layout:fragment="content">
    <main class="container">
        <h2>üßæ Th√¥ng tin thanh to√°n</h2>
        <form id="checkout-form" action="/checkout/process" method="post" class="checkout-form">
            <label for="name">H·ªç v√† t√™n:</label>
            <input type="text" id="name" name="name" required>

            <label for="email">Email:</label>
            <input type="email" id="email" name="email" required>

            <label for="phone">S·ªë ƒëi·ªán tho·∫°i:</label>
            <input type="text" id="phone" name="phone" required>

            <label for="address">ƒê·ªãa ch·ªâ giao h√†ng:</label>
            <textarea id="address" name="address" required></textarea>

            <h3>ƒê∆°n h√†ng c·ªßa b·∫°n</h3>
            <table class="cart-summary">
                <thead>
                <tr>
                    <th>S·∫£n ph·∫©m</th>
                    <th>S·ªë l∆∞·ª£ng</th>
                    <th>T·ªïng</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="item : ${cart.itemList}">
                    <td th:text="${item.product.name}">T√™n s·∫£n ph·∫©m</td>
                    <td th:text="${item.quantity}">1</td>
                    <td th:text="${item.product.price * item.quantity} + ' ƒë'">0 ƒë</td>
                </tr>
                </tbody>
            </table>

            <div class="checkout-total">
                <strong>T·ªïng c·ªông:</strong>
                <span th:text="${cart.totalPrice} + ' ƒë'">0 ƒë</span>
            </div>

            <!-- Ph∆∞∆°ng th·ª©c thanh to√°n -->
            <div class="payment-method">
                <h4>Ph∆∞∆°ng th·ª©c thanh to√°n</h4>
                <label><input type="radio" name="paymentMethod" value="cod" checked> Thanh to√°n khi nh·∫≠n h√†ng (COD)</label><br>
                <label><input type="radio" name="paymentMethod" value="bank"> Chuy·ªÉn kho·∫£n ng√¢n h√†ng</label><br>
                <label><input type="radio" name="paymentMethod" value="momo"> V√≠ MoMo</label>
            </div>

            <!-- QR Modal -->
            <div id="qr-modal" class="qr-modal">
                <p>Vui l√≤ng qu√©t m√£ QR ƒë·ªÉ thanh to√°n:</p>
                <img id="qr-img" src="" alt="M√£ QR">
                <br>
                <button type="button" id="confirm-paid-btn" class="btn btn-success">T√¥i ƒë√£ thanh to√°n</button>
            </div>

            <button type="submit" id="submit-btn" class="btn btn-primary">X√°c nh·∫≠n ƒë·∫∑t h√†ng</button>
        </form>

        <!-- Script ƒë·ªÉ x·ª≠ l√Ω QR -->
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const form = document.getElementById("checkout-form");
                const submitBtn = document.getElementById("submit-btn");
                const qrModal = document.getElementById("qr-modal");
                const qrImg = document.getElementById("qr-img");
                const confirmBtn = document.getElementById("confirm-paid-btn");

                form.addEventListener("submit", function (e) {
                    const selectedMethod = document.querySelector("input[name='paymentMethod']:checked").value;

                    if (selectedMethod === "bank" || selectedMethod === "momo") {
                        e.preventDefault(); // NgƒÉn submit

                        qrImg.src = selectedMethod === "bank" ? "/images/qr-bank.png" : "/images/qr-momo.png";
                        qrModal.style.display = "block";
                        submitBtn.disabled = true;
                    }
                    // N·∫øu l√† COD th√¨ cho ph√©p submit lu√¥n
                });

                confirmBtn.addEventListener("click", function () {
                    qrModal.style.display = "none";
                    submitBtn.disabled = false;
                    form.submit(); // G·ª≠i l·∫°i form sau khi ng∆∞·ªùi d√πng x√°c nh·∫≠n ƒë√£ thanh to√°n
                });
            });
        </script>
    </main>
</div>
</body>
</html>
